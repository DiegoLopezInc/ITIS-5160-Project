<%- include('../partials/header.ejs', { title: 'Create a New Event - ColorStack UNC Charlotte', extraCSS: ['eventForm'] }) %>
<div class="form-container">
    <h2>Create New Event</h2>
    <% if (errorMessages && errorMessages.length > 0) { %>
        <div class="error-messages">
            <% errorMessages.forEach(message => { %>
                <p class="error"><%= message %></p>
            <% }); %>
        </div>
    <% } %>
    <form class="connection-form" action="/events" method="POST">
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" id="title" name="title" placeholder="Enter the title of the event" required>
        </div>

        <div class="form-group">
            <label for="category">Category</label>
            <select id="category" name="category" required>
                <option value="">Select a category</option>
                <% categories.forEach(category => { %>
                    <option value="<%= category.toLowerCase() %>"><%= category %></option>
                <% }); %>
            </select>
        </div>

        <div class="form-group">
            <label for="description">Details</label>
            <textarea id="description" name="description" placeholder="Enter a short description of the event" required></textarea>
        </div>

        <div class="form-group">
            <label for="location">Location</label>
            <select id="location" name="location" onchange="updateImage()" required>
                <option value="">Select a location</option>
                <% locations.forEach(location => { %>
                    <option value="<%= location.name %>" data-image="<%= location.image %>"><%= location.name %></option>
                <% }); %>
            </select>
        </div>

        <input type="hidden" id="image" name="image" required>

        <div id="imagePreview" style="display: none;">
            <img id="locationImage" src="" alt="Location Preview">
        </div>

        <div class="form-group">
            <label for="when">Date</label>
            <input type="date" id="when" name="when" required>
        </div>

        <div class="form-group">
            <label for="start">Start Time</label>
            <input type="time" id="start" name="start" required>
        </div>

        <div class="form-group">
            <label for="end">End Time</label>
            <input type="time" id="end" name="end" required>
        </div>

        <button type="submit">Create Event</button>
    </form>
</div>

<script>
function updateImage() {
    const select = document.getElementById('location');
    const selectedOption = select.options[select.selectedIndex];
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('imagePreview');
    const locationImage = document.getElementById('locationImage');

    if (selectedOption.value) {
        const imagePath = selectedOption.getAttribute('data-image');
        imageInput.value = imagePath;
        locationImage.src = imagePath;
        imagePreview.style.display = 'block';
    } else {
        imageInput.value = '';
        imagePreview.style.display = 'none';
    }
}
</script>

<%- include('../partials/footer.ejs') %>