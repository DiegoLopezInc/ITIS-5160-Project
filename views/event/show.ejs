<%- include('../partials/header.ejs')%>
<link rel="stylesheet" href="/css/eventDetail.css">
<main>
    <div class="eventDetail">
        <h2><%= event.title %></h2>
        
        <% if (successMessages && successMessages.length > 0) { %>
            <div class="successMessages">
                <% successMessages.forEach(message => { %>
                    <p class="success"><%= message %></p>
                <% }); %>
            </div>
        <% } %>

        <div class="eventImageContainer">
            <img src="<%= event.image %>" alt="<%= event.title %>" loading="lazy">
        </div>

        <div class="eventInfo">
            <p><strong>Host:</strong> <%= event.host.firstName %> <%= event.host.lastName %></p>
            <p><strong>Date:</strong> <%= event.startDateTime.toLocaleDateString() %></p>
            <p><strong>Time:</strong> 
                <%= event.startDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %> - 
                <%= event.endDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
            </p>
            <p><strong>Location:</strong> <%= event.location %></p>
            <p class="eventDescription"><strong>Description:</strong> <%= event.description %></p>
            <p><strong>Attending:</strong> <%= rsvpCount %> people</p>
        </div>
        
        <% if(user) { %>
            <% if(user.id !== event.host._id.toString()) { %>
                <div class="rsvpActions">
                    <form action="/events/<%= event._id %>/rsvp" method="POST" class="rsvpForm">
                        <button type="submit" name="status" value="YES" 
                            class="btn <%= userRsvp && userRsvp.status === 'YES' ? 'active' : '' %>">
                            Going
                        </button>
                        <button type="submit" name="status" value="MAYBE" 
                            class="btn <%= userRsvp && userRsvp.status === 'MAYBE' ? 'active' : '' %>">
                            Maybe
                        </button>
                        <button type="submit" name="status" value="NO" 
                            class="btn <%= userRsvp && userRsvp.status === 'NO' ? 'active' : '' %>">
                            Not Going
                        </button>
                    </form>
                </div>
            <% } %>
            <% if(user.id === event.host._id.toString()) { %>
                <div class="eventActions">
                    <a href="/events/<%= event._id %>/edit" class="btn">Edit Event</a>
                    <form action="/events/<%= event._id %>?_method=DELETE" method="POST" class="inlineForm">
                        <button type="submit" class="btn btnDelete" onclick="return confirm('Are you sure you want to delete this event?')">
                            Delete Event
                        </button>
                    </form>
                </div>
            <% } %>
        <% } else { %>
            <p class="loginPrompt">Please <a href="/users/login">login</a> to RSVP for this event.</p>
        <% } %>
        
        <a href="/events" class="btn btnBack">Back to Events</a>
    </div>
</main>
<%- include('../partials/footer.ejs')%>